import{r as a,j as e,s as ae,u as te,q as ie,b as re,v as ne,w as le,e as p,C as oe,R as k,d as L,N as m}from"./index-64dcebe6.js";import{V as M}from"./VideoJs-185fbf03.js";import"./sweetalert2.esm.all-df3a4912.js";import{S as T,N as E,a as V}from"./swiper-slide-2907628c.js";import{T as D}from"./thumbs-57c72272.js";import{T as v}from"./Tab-b0d70a0e.js";import"./video.es-e07de406.js";a.forwardRef(({options:u,onReady:c,isOpen:i,onClose:g},n)=>{const t=a.useRef(null);return a.useEffect(()=>{i&&t.current&&t.current.player.play()},[i]),e.jsx("div",{className:`pop-out-player ${i?"open":"closed"}`,onClick:g,children:e.jsx("div",{className:"player-container",onClick:l=>l.stopPropagation(),children:e.jsx(M,{options:u,onReady:c,ref:n,style:{width:"100%",height:"100%"}})})})});const _=a.memo(({image_url:u,name:c,role:i})=>e.jsxs("div",{className:"cast-item",children:[e.jsx("img",{src:u,alt:c,className:"cast-image"}),e.jsx("p",{className:"cast-name",children:c||"Loading..."}),e.jsx("p",{className:"cast-role",children:i})]}));_.displayName="CastCard";const ce=a.memo(()=>{a.useState(!1);const u=ae.useRef(null),{t:c}=te(),[i,g]=a.useState(null),{id:n}=ie(),t=re(s=>{var r;return(r=s.user)==null?void 0:r.user}),l="http://localhost:4000",[y,S]=a.useState(!1),[C,R]=a.useState(!0),[J,K]=a.useState(!1),[G,b]=a.useState(!1),[O,j]=a.useState(0),[z,A]=a.useState(0),[I,q]=a.useState([]),[F,U]=a.useState([]),[W,Y]=a.useState([]),[w,B]=a.useState(null),{isAuthenticated:h}=ne(),x=le(),f=a.useCallback(async()=>{try{R(!0);const[s,r,N,P]=await Promise.all([p.get(`${l}/api/movies/${n}`),t?p.get(`${l}/api/movies/${n}/like`,{params:{userId:t._id}}):Promise.resolve(null),p.get(`${l}/api/movies/${n}/like-count`),t?p.post(`${l}/api/payments/status`,{userId:t._id,movieId:n}):Promise.resolve(null)]),o=s.data.data;if(o.release_year=new Date(o.release_date).getFullYear(),g(o),o.trailer_url&&B(o.trailer_url),console.log("Trailer url",o.trailer_url),r&&b(r.data.isLiked),j(N.data.likeCount),P){const{hasPaid:d,remainingTime:se}=P.data;S(d),A(se)}const ee=o.castAndCrews.map(d=>({_id:d.person._id,name:d.person.name,image_url:d.person.image_url,role:d.role,type:d.type}));q(ee)}catch(s){console.error("Error fetching data:",s)}finally{R(!1),K(!0)}},[l,n,t]);a.useEffect(()=>{f()},[f]),a.useEffect(()=>{U({autoplay:!1,controls:!0,responsive:!0,techOrder:["youtube"],sources:[{src:`https://www.youtube.com/watch?v=${w}`,type:"video/youtube"}],youtube:{iv_load_policy:1}}),Y({autoplay:!1,controls:!0,responsive:!0,techOrder:["youtube"],sources:[{src:`https://www.youtube.com/watch?v=${w}`||"",type:"video/youtube"}],youtube:{iv_load_policy:1}})},[w]);const H=I.filter(s=>s.type==="cast"),Q=I.filter(s=>s.type==="crew"),$=()=>setShowModal(!0),X=a.useCallback(s=>{u.current=s,s.on("play",$),s.on("waiting",()=>{videojs.log("player is waiting")}),s.on("dispose",()=>{videojs.log("player will dispose")})},[$]);a.useCallback(async()=>{if(!h){x("/login",{state:{from:location}});return}try{const s=await p.post(`${l}/api/payments/initiate`,{userId:t._id,contentId:n,contentType:"Movie"}),{orderId:r}=s.data,N={key:"rzp_test_jJ41CHspPJeQFW",amount:i.ppv_cost*100,currency:"INR",name:"Movie Payment",description:`Payment for movie: ${i.title}`,order_id:r,handler:async function(o){console.log("Payment successful:",o),S(!0),await f()},prefill:{name:t.full_name,email:t.email,contact:t.phone},notes:{userId:t._id,contentId:n,contentType:"Movie"},theme:{color:"#F37254"}};new window.Razorpay(N).open()}catch(s){console.error("Error initiating payment:",s)}},[l,f,n,i,t,h,x,location]);const Z=a.useCallback(async()=>{if(!h){x("/login",{state:{from:location}});return}try{(await p.post(`${l}/api/movies/${n}/like`,{userId:t._id})).data.message==="Like removed successfully"?(b(!1),j(r=>r-1)):(b(!0),j(r=>r+1))}catch(s){console.error("Error liking the movie:",s)}},[l,n,t,h,x,location]);return C||!i||!J?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:`detail-page ${C?"loading":"loaded"}`,children:e.jsx("div",{className:"iq-main-slider site-video",children:e.jsx(oe,{fluid:!0,children:e.jsx(k,{children:e.jsx(L,{lg:"12",children:e.jsxs("div",{className:"movie-details-container",children:[e.jsx("div",{className:"movie-details-content",children:e.jsxs("div",{className:"video-container",children:[e.jsx(M,{options:y?F:W,onReady:X}),!y&&e.jsx("div",{className:"trailer-tag",children:"Trailer"})]})}),e.jsxs("div",{className:"movie-details-description ml-3",children:[e.jsx(k,{children:e.jsxs(L,{md:"12",className:"mb-auto",children:[e.jsx("div",{className:"d-block d-lg-flex align-items-center",children:e.jsx("h2",{className:"trending-text fw-bold text-uppercase my-0 fadeInLeft animated d-inline-block",children:i.title})}),e.jsxs("div",{className:"d-block d-lg-flex align-items-center mb-2",children:[e.jsxs("span",{className:"border border-white p-1",children:["Release Year: ",i.release_year]}),e.jsx("span",{className:"ms-3 font-Weight-500 genres-info me-2 border border-white p-1",children:"1hr : 48mins"})]}),e.jsxs("div",{className:"d-flex flex-wrap align-items-center text-white text-detail flex-wrap mb-4",children:[e.jsx("span",{className:"badge bg-primary",children:i.genres}),e.jsx("span",{className:"trending-year trending-year-list font-Weight-500 genres-info",children:i.created_at})]}),e.jsxs("div",{className:"d-flex align-items-center gap-4 flex-wrap mb-4",children:[e.jsx("ul",{className:"list-inline p-0 share-icons music-play-lists mb-n2 mx-n2",children:e.jsx("li",{children:e.jsx("span",{onClick:Z,children:e.jsx("i",{className:`fa-heart ${G?"fa-solid":"far"}`})})})}),e.jsxs("span",{className:"text-white",children:[O," likes"]})]})]})}),y?e.jsxs("span",{children:["You have"," ",e.jsx("span",{className:"text-primary text-strong",children:z})," ","to watch this movie"]}):e.jsxs("div",{className:"coming-soon-notice",children:[e.jsx("span",{className:"text-primary",children:"Coming Soon!"}),e.jsx("p",{className:"mt-2",children:"Movie rentals will be available shortly."})]}),e.jsx(k,{children:e.jsx("div",{className:"details-part content-details trending-info",children:e.jsxs(v.Container,{defaultActiveKey:"first",children:[e.jsxs(m,{className:"iq-custom-tab tab-bg-gredient-center d-flex nav nav-pills align-items-center text-center mb-5 justify-content-left list-inline",children:[e.jsx(m.Item,{children:e.jsx(m.Link,{eventKey:"first",variant:" d-flex align-items-center",id:"nav-description-tab","data-bs-toggle":"tab","data-bs-target":"#nav-description",type:"button",role:"tab","aria-controls":"nav-description","aria-selected":"true",children:c("detail_page.description")})}),e.jsx(m.Item,{children:e.jsx(m.Link,{eventKey:"second",variant:"",id:"nav-review-tab","data-bs-toggle":"tab","data-bs-target":"#nav-review",type:"button",role:"tab","aria-controls":"nav-review","aria-selected":"false",children:"Casts"})}),e.jsx(m.Item,{children:e.jsx(m.Link,{eventKey:"third",variant:"",id:"nav-review-tab","data-bs-toggle":"tab","data-bs-target":"#nav-review",type:"button",role:"tab","aria-controls":"nav-review","aria-selected":"false",children:"Crews"})})]}),e.jsxs(v.Content,{children:[e.jsx(v.Pane,{className:"fade show",eventKey:"first",id:"nav-description",role:"tabpanel","aria-labelledby":"nav-description-tab",children:e.jsx("p",{children:c(i.description)})}),e.jsx(v.Pane,{className:"fade",id:"nav-review",eventKey:"second",role:"tabpanel","aria-labelledby":"nav-review-tab",children:e.jsxs("div",{className:"cast-slider-container",children:[e.jsx(T,{modules:[E,D],navigation:{prevEl:".cast-prev",nextEl:".cast-next"},spaceBetween:16,watchOverflow:!0,observer:!0,observeParents:!0,breakpoints:{0:{slidesPerView:2,slidesPerGroup:2},768:{slidesPerView:4,slidesPerGroup:2},1025:{slidesPerView:6,slidesPerGroup:3}},className:"cast-swiper",children:H.map((s,r)=>e.jsx(V,{children:e.jsx(_,{image_url:s.image_url,name:s.name,role:s.role})},r))}),e.jsx("div",{className:"cast-prev swiper-button",children:e.jsx("i",{className:"fa fa-chevron-left"})}),e.jsx("div",{className:"cast-next swiper-button",children:e.jsx("i",{className:"fa fa-chevron-right"})})]})}),e.jsx(v.Pane,{className:"fade",id:"nav-review",eventKey:"third",role:"tabpanel","aria-labelledby":"nav-review-tab",children:e.jsxs("div",{className:"cast-slider-container",children:[e.jsx(T,{modules:[E,D],navigation:{prevEl:".crew-prev",nextEl:".crew-next"},spaceBetween:16,watchOverflow:!0,observer:!0,observeParents:!0,breakpoints:{0:{slidesPerView:2,slidesPerGroup:2},768:{slidesPerView:4,slidesPerGroup:2},1025:{slidesPerView:6,slidesPerGroup:3}},className:"cast-swiper",children:Q.map((s,r)=>e.jsx(V,{children:e.jsx(_,{image_url:s.image_url,name:s.name,role:s.role})},r))}),e.jsx("div",{className:"crew-prev swiper-button",children:e.jsx("i",{className:"fa fa-chevron-left"})}),e.jsx("div",{className:"crew-next swiper-button",children:e.jsx("i",{className:"fa fa-chevron-right"})})]})})]})]})})})]})]})})})})})})});ce.displayName="DetailPage";export{ce as default};
