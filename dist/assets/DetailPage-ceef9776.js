import{r as a,u as se,q as ae,b as te,e as h,j as e,C as E,R as g,d as j,N as o,L as ie}from"./index-64dcebe6.js";import{u as ne}from"./usePage-2ed11758.js";import{C as le}from"./choice-9aff905c.js";import{F as re}from"./index-feb8977f.js";import"./fslight-box-9a30ea0b.js";import{V as I}from"./VideoJs-185fbf03.js";import{m as oe}from"./index-21da7072.js";import{S as $}from"./sweetalert2.esm.all-df3a4912.js";import{T as d}from"./Tab-b0d70a0e.js";import"./video.es-e07de406.js";import"./iconBase-42b2867d.js";const ce=a.memo(()=>{const{t:x}=se(),{id:l}=ae(),[i,T]=a.useState(null),[K,S]=a.useState(!0),[C,F]=a.useState(null),[z,O]=a.useState([]),n=te(s=>{var t;return(t=s.user)==null?void 0:t.user}),[y,D]=a.useState(1),[m,N]=a.useState({toggler:!1,slide:1}),c="http://localhost:4000",[v,_]=a.useState(!1),[J,q]=a.useState(0),[M,A]=a.useState(!1),[U,w]=a.useState(!1),[W,k]=a.useState(0),[P,Y]=a.useState(null),b=a.useCallback(async()=>{try{S(!0);const[s,t,p,u]=await Promise.all([h.get(`${c}/api/tvShows/${l}`),n?h.get(`${c}/api/tvShows/${l}/like`,{params:{userId:n._id}}):Promise.resolve(null),h.get(`${c}/api/tvShows/${l}/like-count`),n?h.post(`${c}/api/payments/status`,{userId:n._id,tvShowId:l}):Promise.resolve(null)]),r=s.data;r.release_year=new Date(r.release_date).getFullYear(),T(r),r.trailer_url&&Y(r.trailer_url);const ee=r.seasons.map((R,f)=>({value:f+1,label:`Season ${f+1}`}));if(O(ee),t&&w(t.data.isLiked),k(p.data.likeCount),u){const{hasPaid:R,remainingTime:f}=u.data;_(R),q(f)}}catch(s){console.error("Error fetching data:",s),F(s.message)}finally{S(!1),A(!0)}},[c,l,n]);a.useEffect(()=>{b()},[b]);const G=a.useMemo(()=>({autoplay:!1,controls:!0,responsive:!0,techOrder:["youtube"],sources:[{src:"https://www.youtube.com/watch?v=Q1GlkwGSkO0",type:"video/youtube"}],youtube:{iv_load_policy:1}}),[]),H=a.useMemo(()=>({autoplay:!1,controls:!0,responsive:!0,techOrder:["youtube"],sources:[{src:P||"",type:"video/youtube"}],youtube:{iv_load_policy:1}}),[P]),Q=a.useCallback(async()=>{if(!n){$.fire({icon:"error",title:"Please login first"});return}try{(await h.post(`${c}/api/tvShows/${l}/like`,{userId:n._id})).data.message==="Like removed successfully"?(w(!1),k(t=>t-1)):(w(!0),k(t=>t+1))}catch(s){console.error("Error liking the movie:",s)}},[c,l,n]),V=a.useCallback(async()=>{if(!n){$.fire({icon:"error",title:"Please login first"});return}try{const s=await h.post(`${c}/api/payments/initiate`,{userId:n._id,tvShowId:l}),{orderId:t}=s.data,p={key:"rzp_test_jJ41CHspPJeQFW",amount:i.ppv_cost*100,currency:"INR",name:"Series Payment",description:`Payment for Tv Series: ${i.title}`,order_id:t,handler:async function(r){console.log("Payment successful:",r),_(!0),await b()},prefill:{name:n.full_name,email:n.email,contact:n.phone},notes:{userId:n._id,tvShowId:l},theme:{color:"#F37254"}};new window.Razorpay(p).open()}catch(s){console.error("Error initiating payment:",s)}},[c,b,l,i,n]);ne();const B=s=>{D(Number(s.target.value))},X=s=>{N({toggler:!m.toggler,slide:s})},Z=a.useRef(null),L=a.useCallback(s=>{Z.current=s,s.on("waiting",()=>{videojs.log("player is waiting")}),s.on("dispose",()=>{videojs.log("player will dispose")})},[]);return K||!i||!M?e.jsx("div",{children:"Loading..."}):C?e.jsxs("div",{children:["Error: ",C]}):e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"movie-details-container",children:e.jsx(E,{fluid:!0,children:e.jsxs(g,{children:[e.jsx(j,{lg:"6",children:e.jsx("div",{className:"movie-details-content",children:v?e.jsx(I,{options:G,onReady:L}):e.jsxs("div",{className:"video-container",children:[e.jsx(I,{options:H,onReady:L}),e.jsx("div",{className:"trailer-tag",children:"Trailer"})]})})}),e.jsx(j,{lg:"6",children:e.jsxs("div",{className:"movie-details-description",children:[e.jsx(g,{children:e.jsxs(j,{md:"9",className:"mb-auto",children:[e.jsx("div",{className:"d-block d-lg-flex align-items-center",children:e.jsx("h2",{className:"trending-text fw-bold text-uppercase my-0 fadeInLeft animated d-inline-block",children:i.show_name})}),e.jsxs("div",{className:"d-block d-lg-flex align-items-center mb-2",children:[e.jsxs("span",{className:"border border-white p-1",children:["Release Year: ",i.release_year]}),e.jsx("span",{className:"ms-3 font-Weight-500 genres-info me-2 border border-white p-1",children:"1hr : 48mins"})]}),e.jsxs("div",{className:"d-flex flex-wrap align-items-center text-white text-detail flex-wrap mb-4",children:[e.jsx("span",{className:"badge bg-primary",children:i.genres}),e.jsx("span",{className:"trending-year trending-year-list font-Weight-500 genres-info",children:i.created_at})]}),e.jsxs("div",{className:"d-flex align-items-center gap-4 flex-wrap mb-4",children:[e.jsx("ul",{className:"list-inline p-0 share-icons music-play-lists mb-n2 mx-n2",children:e.jsx("li",{children:e.jsx("span",{onClick:Q,children:e.jsx("i",{className:`fa-heart ${U?"fa-solid":"far"}`})})})}),e.jsxs("span",{className:"text-white",children:[W," likes"]})]})]})}),v?e.jsxs("span",{children:["You have"," ",e.jsx("span",{className:"text-primary text-strong",children:J})," ","to watch this movie"]}):e.jsxs("button",{className:"pay-button",onClick:V,children:[e.jsx(oe,{size:"1.5em"})," Rent for Rs."," ",i.ppv_cost," (3 days)"]}),e.jsx(g,{children:e.jsx("div",{className:"details-part content-details trending-info",children:e.jsxs(d.Container,{defaultActiveKey:"first",children:[e.jsxs(o,{className:"iq-custom-tab tab-bg-gredient-center d-flex nav nav-pills align-items-center text-center mb-5 justify-content-left list-inline",children:[e.jsx(o.Item,{children:e.jsx(o.Link,{eventKey:"first",variant:" d-flex align-items-center",id:"nav-description-tab","data-bs-toggle":"tab","data-bs-target":"#nav-description",type:"button",role:"tab","aria-controls":"nav-description","aria-selected":"true",children:x("detail_page.description")})}),e.jsx(o.Item,{children:e.jsx(o.Link,{eventKey:"second",variant:"",id:"nav-review-tab","data-bs-toggle":"tab","data-bs-target":"#nav-review",type:"button",role:"tab","aria-controls":"nav-review","aria-selected":"false",children:"Casts and Crews"})})]}),e.jsxs(d.Content,{children:[e.jsx(d.Pane,{className:"fade show",eventKey:"first",id:"nav-description",role:"tabpanel","aria-labelledby":"nav-description-tab",children:e.jsx("p",{children:x(i.description)})}),e.jsx(d.Pane,{className:"fade",id:"nav-review",eventKey:"second",role:"tabpanel","aria-labelledby":"nav-review-tab",children:i==null?void 0:i.casts})]})]})})})]})})]})})}),e.jsx("div",{className:"show-detail section-padding",children:e.jsxs(E,{fluid:!0,children:[e.jsx("div",{className:"show-movie-section",children:e.jsx("div",{className:"iq-custom-select d-inline-block",children:e.jsx(le,{options:z,className:"js-choice",select:"one",name:"season-selector",onChange:B})})}),e.jsx("div",{className:"show-custom-tab",children:e.jsxs(d.Container,{defaultActiveKey:"first",children:[e.jsxs(o,{className:"iq-custom-tab tab-bg-fill nav nav-pills text-center list-inline my-4",children:[e.jsx(o.Item,{children:e.jsx(o.Link,{eventKey:"first",variant:" d-flex align-items-center",id:"nav-episodes-tab","data-bs-toggle":"tab","data-bs-target":"#nav-episodes",type:"button",role:"tab","aria-controls":"nav-episodes","aria-selected":"true",className:"m-0",children:x("detail_page.episode")})}),e.jsx(o.Item,{children:e.jsx(o.Link,{eventKey:"second",variant:"",id:"nav-description-tab","data-bs-toggle":"tab","data-bs-target":"#nav-description",type:"button",role:"tab","aria-controls":"nav-description","aria-selected":"false",className:"m-0",children:x("detail_page.description")})})]}),e.jsxs(d.Content,{children:[e.jsx(d.Pane,{className:" fade show",eventKey:"first",id:"nav-episodes",role:"tabpanel","aria-labelledby":"nav-episodes-tab",children:e.jsxs(g,{className:"list-inline p-0 mb-0",children:[i.seasons.filter(s=>s.season_no===y).flatMap(s=>s.episodes.map((t,p)=>e.jsx(j,{lg:3,sm:12,md:6,className:`${p===s.episodes.length-1?"mt-3 mt-md-0":""}`,children:e.jsxs("div",{className:"episode-block",children:[e.jsxs("div",{className:"block-image position-relative",children:[e.jsx("img",{src:t.horizontal_poster,alt:"showImg",className:"img-fluid img-zoom episode-thumbnail",loading:"lazy"}),e.jsxs("div",{className:"episode-number",children:["Episode No. ",t.episode_no]}),e.jsx("div",{className:"episode-play",children:v?e.jsx("span",{onClick:()=>X(p+1),children:e.jsx("i",{className:"fa-solid fa-play"})}):e.jsx("span",{children:e.jsx("i",{className:"fa-solid fa-lock"})})}),e.jsx(re,{toggler:m.toggler,sources:i.seasons.filter(u=>u.season_no===y).flatMap(u=>u.episodes.map(r=>r.video_url)),slide:m.slide,onOpen:()=>{document.documentElement.requestFullscreen()},onClose:()=>{document.fullscreenElement&&document.exitFullscreen()},customControls:[e.jsx("button",{onClick:()=>N({...m,slide:m.slide-1}),children:"Prev Episode"},"prev"),e.jsx("button",{onClick:()=>N({...m,slide:m.slide+1}),children:"Next Episode"},"next")]})]}),e.jsxs("div",{className:"epi-desc p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsx("span",{className:"border-gredient-left text-white rel-date",children:new Date(t.release_date).toLocaleDateString()}),e.jsx("span",{className:"text-primary run-time",children:t.duration})]}),e.jsx(ie,{to:"/episodes",children:e.jsx("h5",{className:"epi-name text-white mb-0",children:t.title})}),e.jsx("p",{children:t.description})]})]})},p))),!v&&e.jsxs("button",{className:"btn btn-lg btn-primary",children:["Rent All Episodes (Rs. ",i.ppv_cost,") : Season ",y]})]})}),e.jsx(d.Pane,{className:" fade",id:"nav-description",eventKey:"second",role:"tabpanel","aria-labelledby":"nav-description-tab",children:e.jsx("p",{children:x(i.description)})}),e.jsx(d.Pane,{className:" fade",id:"nav-review",eventKey:"third",role:"tabpanel","aria-labelledby":"nav-review-tab"})]})]})})]})})]})});ce.displayName="TvShowsDetail";export{ce as default};
